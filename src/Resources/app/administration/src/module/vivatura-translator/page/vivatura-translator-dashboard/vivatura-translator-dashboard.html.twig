{% block vivatura_translator_dashboard %}
<sw-page class="vivatura-translator-dashboard">
    {% block vivatura_translator_dashboard_header %}
    <template #smart-bar-header>
        <h2>{{ $tc('vivatura-translator.dashboard.title') }}</h2>
    </template>
    {% endblock %}

    {% block vivatura_translator_dashboard_content %}
    <template #content>
        <sw-card-view>
            {# Status Overview #}
            {% block vivatura_translator_status %}
            <sw-card :title="$tc('vivatura-translator.dashboard.statusTitle')" :isLoading="isAnyLoading">
                <div class="vivatura-translator-status-grid">
                    <div class="status-item">
                        <span class="status-value">{{ status.languages }}</span>
                        <span class="status-label">{{ $tc('vivatura-translator.dashboard.languages') }}</span>
                    </div>
                    <div class="status-item">
                        <span class="status-value">{{ status.products }}</span>
                        <span class="status-label">{{ $tc('vivatura-translator.dashboard.products') }}</span>
                    </div>
                    <div class="status-item">
                        <span class="status-value">{{ status.cmsPages }}</span>
                        <span class="status-label">{{ $tc('vivatura-translator.dashboard.cmsPages') }}</span>
                    </div>
                    <div class="status-item">
                        <span class="status-value">{{ status.snippetSets }}</span>
                        <span class="status-label">{{ $tc('vivatura-translator.dashboard.snippetSets') }}</span>
                    </div>
                </div>
            </sw-card>
            {% endblock %}

            {# Language Selection #}
            {% block vivatura_translator_languages %}
            <sw-card :title="$tc('vivatura-translator.dashboard.selectLanguages')" v-if="activeTab !== 'snippets' && activeTab !== 'settings'">
                <div class="vivatura-translator-language-selection">
                    <div class="language-actions">
                        <sw-button size="small" @click="selectAllLanguages">
                            {{ $tc('vivatura-translator.modal.selectAll') }}
                        </sw-button>
                        <sw-button size="small" @click="deselectAllLanguages">
                            {{ $tc('vivatura-translator.modal.deselectAll') }}
                        </sw-button>
                    </div>
                    <div class="language-list">
                        <div
                            v-for="language in availableLanguages"
                            :key="language.id"
                            class="language-item"
                            :class="{ 'is-selected': isLanguageSelected(language.id) }"
                        >
                            <sw-checkbox-field
                                :value="isLanguageSelected(language.id)"
                                @change="toggleLanguage(language.id)"
                            />
                            <span class="language-name" @click="toggleLanguage(language.id)">{{ language.name }}</span>
                            <span class="language-locale" @click="toggleLanguage(language.id)">({{ language.locale }})</span>
                        </div>
                    </div>
                </div>
            </sw-card>
            {% endblock %}

            {# Tabs #}
            {% block vivatura_translator_tabs %}
            <sw-tabs :small="false" :default-item="activeTab" @new-item-active="onTabChange">
                <sw-tabs-item name="products">
                    {{ $tc('vivatura-translator.dashboard.tabProducts') }}
                </sw-tabs-item>
                <sw-tabs-item name="cms">
                    {{ $tc('vivatura-translator.dashboard.tabCmsPages') }}
                </sw-tabs-item>
                <sw-tabs-item name="snippets">
                    {{ $tc('vivatura-translator.dashboard.tabSnippets') }}
                </sw-tabs-item>
                <sw-tabs-item name="settings">
                    {{ $tc('vivatura-translator.dashboard.tabSettings') }}
                </sw-tabs-item>
            </sw-tabs>
            {% endblock %}

            {# Products Tab #}
            {% block vivatura_translator_products %}
            <sw-card v-if="activeTab === 'products'" :isLoading="isLoadingProducts">
                <template #toolbar>
                    <sw-container columns="1fr auto" gap="16px">
                        <sw-simple-search-field
                            v-model="productSearch"
                            @search-term-change="onProductSearch"
                            :placeholder="$tc('vivatura-translator.dashboard.searchProducts')"
                        />
                        <sw-button
                            variant="primary"
                            :disabled="!canTranslateProducts || isTranslating"
                            @click="translateSelectedProducts"
                        >
                            <template v-if="isTranslating">
                                <sw-loader size="16px" />
                                {{ $tc('vivatura-translator.modal.translating') }}
                            </template>
                            <template v-else>
                                {{ $tc('vivatura-translator.dashboard.translateSelected') }} ({{ selectedProducts.length }})
                            </template>
                        </sw-button>
                    </sw-container>
                </template>

                <sw-data-grid
                    :dataSource="products"
                    :columns="[
                        { property: 'productNumber', label: $tc('vivatura-translator.dashboard.productNumber') },
                        { property: 'name', label: $tc('vivatura-translator.dashboard.name'), primary: true },
                        { property: 'translationCount', label: $tc('vivatura-translator.dashboard.translations'), width: '120px' }
                    ]"
                    :showSelection="true"
                    :showActions="false"
                    identifier="vivatura-products"
                    @selection-change="onProductSelectionChange"
                >
                    <template #column-name="{ item }">
                        {{ item.name }}
                    </template>
                </sw-data-grid>

                <template #footer>
                    <div class="vivatura-card-footer">
                        <sw-pagination
                            :total="productTotal"
                            :limit="productLimit"
                            :page="productPage"
                            @page-change="onProductPageChange"
                        />
                        <div class="selection-info">
                            <span>{{ selectedProducts.length }} {{ $tc('vivatura-translator.dashboard.selected') }}</span>
                        </div>
                    </div>
                </template>
            </sw-card>
            {% endblock %}

            {# CMS Pages Tab #}
            {% block vivatura_translator_cms %}
            <sw-card v-if="activeTab === 'cms'" :isLoading="isLoadingCms">
                <template #toolbar>
                    <sw-container columns="1fr auto" gap="16px">
                        <sw-simple-search-field
                            v-model="cmsSearch"
                            @search-term-change="onCmsSearch"
                            :placeholder="$tc('vivatura-translator.dashboard.searchCmsPages')"
                        />
                        <sw-button
                            variant="primary"
                            :disabled="!canTranslateCmsPages || isTranslating"
                            @click="translateSelectedCmsPages"
                        >
                            <template v-if="isTranslating">
                                <sw-loader size="16px" />
                                {{ $tc('vivatura-translator.modal.translating') }}
                            </template>
                            <template v-else>
                                {{ $tc('vivatura-translator.dashboard.translateSelected') }} ({{ selectedCmsPages.length }})
                            </template>
                        </sw-button>
                    </sw-container>
                </template>

                <sw-data-grid
                    :dataSource="cmsPages"
                    :columns="[
                        { property: 'name', label: $tc('vivatura-translator.dashboard.name'), primary: true },
                        { property: 'type', label: $tc('vivatura-translator.dashboard.type'), width: '120px' },
                        { property: 'slotCount', label: $tc('vivatura-translator.dashboard.slots'), width: '100px' },
                        { property: 'translationCount', label: $tc('vivatura-translator.dashboard.translations'), width: '120px' }
                    ]"
                    :showSelection="true"
                    :showActions="false"
                    identifier="vivatura-cms"
                    @selection-change="onCmsSelectionChange"
                >
                </sw-data-grid>

                <template #footer>
                    <div class="vivatura-card-footer">
                        <sw-pagination
                            :total="cmsTotal"
                            :limit="cmsLimit"
                            :page="cmsPage"
                            @page-change="onCmsPageChange"
                        />
                        <div class="selection-info">
                            <span>{{ selectedCmsPages.length }} {{ $tc('vivatura-translator.dashboard.selected') }}</span>
                        </div>
                    </div>
                </template>
            </sw-card>
            {% endblock %}

            {# Snippets Tab #}
            {% block vivatura_translator_snippets %}
            <sw-card v-if="activeTab === 'snippets'" :isLoading="isLoadingSnippets">
                <template #toolbar>
                    <sw-container columns="1fr 1fr auto" gap="16px">
                        <sw-single-select
                            :value="sourceSnippetSet"
                            @update:value="onSourceSnippetSetChange"
                            :options="snippetSets"
                            labelProperty="name"
                            valueProperty="id"
                            :placeholder="$tc('vivatura-translator.dashboard.sourceSnippetSet')"
                        >
                        </sw-single-select>
                        <sw-single-select
                            :value="targetSnippetSet"
                            @update:value="onTargetSnippetSetChange"
                            :options="snippetSets"
                            labelProperty="name"
                            valueProperty="id"
                            :placeholder="$tc('vivatura-translator.dashboard.targetSnippetSet')"
                        >
                        </sw-single-select>
                        <sw-button
                            variant="primary"
                            :disabled="!canTranslateSnippets || isTranslating"
                            @click="translateSnippetSet"
                        >
                            <template v-if="isTranslating">
                                <sw-loader size="16px" />
                                {{ $tc('vivatura-translator.modal.translating') }}
                            </template>
                            <template v-else>
                                {{ selectedSnippets.length > 0
                                    ? $tc('vivatura-translator.dashboard.translateSelectedSnippets', selectedSnippets.length, { count: selectedSnippets.length })
                                    : $tc('vivatura-translator.dashboard.translateAllSnippets')
                                }}
                            </template>
                        </sw-button>
                    </sw-container>
                </template>

                <sw-alert v-if="!sourceSnippetSet" variant="info">
                    {{ $tc('vivatura-translator.dashboard.selectSourceSet') }}

                    <div style="margin-top: 16px;">
                        <strong>{{ $tc('vivatura-translator.dashboard.bulkTranslateTitle') }}</strong>
                        <p>{{ $tc('vivatura-translator.dashboard.bulkTranslateHint') }}</p>

                        <sw-container columns="1fr 1fr auto" gap="16px" style="margin-top: 12px;">
                            <sw-select-field
                                v-model="bulkSourceIso"
                                :label="$tc('vivatura-translator.dashboard.bulkSourceLanguage')"
                            >
                                <option value="de-DE">Deutsch (de-DE)</option>
                                <option value="en-GB">English (en-GB)</option>
                            </sw-select-field>

                            <sw-select-field
                                v-model="bulkTargetIso"
                                :label="$tc('vivatura-translator.dashboard.bulkTargetLanguage')"
                            >
                                <option value="en-GB">English (en-GB)</option>
                                <option value="fr-FR">Français (fr-FR)</option>
                                <option value="es-ES">Español (es-ES)</option>
                                <option value="it-IT">Italiano (it-IT)</option>
                                <option value="nl-NL">Nederlands (nl-NL)</option>
                                <option value="pl-PL">Polski (pl-PL)</option>
                            </sw-select-field>

                            <sw-button
                                variant="primary"
                                :disabled="!canTranslateAllSnippetSets || isTranslating"
                                @click="translateAllSnippetSets"
                            >
                                {{ $tc('vivatura-translator.dashboard.translateAllSets') }}
                            </sw-button>
                        </sw-container>
                    </div>
                </sw-alert>

                <div v-if="sourceSnippetSet">
                    <sw-simple-search-field
                        v-model="snippetSearch"
                        @search-term-change="onSnippetSearch"
                        :placeholder="$tc('vivatura-translator.dashboard.searchSnippets')"
                        class="snippet-search"
                    />

                    <sw-data-grid
                        :dataSource="snippets"
                        :columns="[
                            { property: 'translationKey', label: $tc('vivatura-translator.dashboard.translationKey'), primary: true },
                            { property: 'value', label: $tc('vivatura-translator.dashboard.value') },
                            { property: 'author', label: $tc('vivatura-translator.dashboard.author'), width: '150px' }
                        ]"
                        :showSelection="true"
                        :showActions="false"
                        identifier="vivatura-snippets"
                        @selection-change="onSnippetSelectionChange"
                    >
                    </sw-data-grid>
                </div>

                <template #footer v-if="sourceSnippetSet">
                    <div class="vivatura-card-footer">
                        <sw-pagination
                            :total="snippetTotal"
                            :limit="snippetLimit"
                            :page="snippetPage"
                            @page-change="onSnippetPageChange"
                        />
                        <div class="selection-info">
                            <span>{{ selectedSnippets.length }} {{ $tc('vivatura-translator.dashboard.selected') }}</span>
                            <span class="hint">{{ $tc('vivatura-translator.dashboard.snippetHint') }}</span>
                        </div>
                    </div>
                </template>
            </sw-card>
            {% endblock %}

            {# Settings Tab #}
            {% block vivatura_translator_settings %}
            <sw-card v-if="activeTab === 'settings'" :title="$tc('vivatura-translator.settings.title')" :isLoading="isAnyLoading">
                <sw-alert variant="info" class="settings-info">
                    {{ $tc('vivatura-translator.settings.infoText') }}
                </sw-alert>

                <div class="language-prompts">
                    <div
                        v-for="language in availableLanguages"
                        :key="language.id"
                        class="language-prompt-item"
                    >
                        <h4>{{ language.name }} ({{ language.locale }})</h4>
                        <sw-textarea-field
                            :value="getPromptForLanguage(language.id)"
                            @input="setPromptForLanguage(language.id, $event)"
                            :placeholder="$tc('vivatura-translator.settings.promptPlaceholder')"
                            rows="3"
                        />
                    </div>
                </div>

                <template #footer>
                    <sw-button variant="primary" @click="savePrompts" :isLoading="isLoading">
                        {{ $tc('vivatura-translator.settings.save') }}
                    </sw-button>
                </template>
            </sw-card>
            {% endblock %}

            {# Progress/Results Modal #}
            {% block vivatura_translator_progress %}
            <sw-modal
                v-if="isTranslating || translationResults"
                :title="$tc('vivatura-translator.modal.translating')"
                @modal-close="translationResults = null"
            >
                <template v-if="isTranslating">
                    <sw-progress-bar :value="translationProgress" />
                    <p>{{ $tc('vivatura-translator.modal.pleaseWait') }}</p>
                </template>
                <template v-else-if="translationResults">
                    <sw-alert :variant="translationResults.summary?.errors > 0 ? 'warning' : 'success'">
                        {{ $tc('vivatura-translator.modal.completed') }}:
                        {{ translationResults.summary?.success || translationResults.translated }} {{ $tc('vivatura-translator.modal.successful') }},
                        {{ translationResults.summary?.errors || translationResults.errors || 0 }} {{ $tc('vivatura-translator.modal.failed') }}
                    </sw-alert>
                </template>
                <template #modal-footer>
                    <sw-button @click="translationResults = null" variant="primary">
                        {{ $tc('vivatura-translator.modal.close') }}
                    </sw-button>
                </template>
            </sw-modal>
            {% endblock %}

        </sw-card-view>
    </template>
    {% endblock %}
</sw-page>
{% endblock %}

{% block vivatura_translator_button %}
<div class="vivatura-translator-button">
    <sw-button
        variant="ghost"
        :disabled="disabled || isLoading"
        @click="openModal"
    >
        <sw-icon name="regular-language" small></sw-icon>
        {{ buttonLabel }}
    </sw-button>

    <sw-modal
        v-if="showModal"
        :title="modalTitle"
        variant="default"
        @modal-close="closeModal"
    >
        {% block vivatura_translator_modal_content %}
        <div class="vivatura-translator-modal-content">
            
            {% block vivatura_translator_language_selection %}
            <div v-if="!translationResults" class="vivatura-translator-language-selection">
                <div class="vivatura-translator-language-header">
                    <h4>{{ $tc('vivatura-translator.modal.selectLanguages') }}</h4>
                    <div class="vivatura-translator-language-actions">
                        <sw-button size="small" @click="selectAllLanguages">
                            {{ $tc('vivatura-translator.modal.selectAll') }}
                        </sw-button>
                        <sw-button size="small" @click="deselectAllLanguages">
                            {{ $tc('vivatura-translator.modal.deselectAll') }}
                        </sw-button>
                    </div>
                </div>

                <sw-loader v-if="isLoading && availableLanguages.length === 0"></sw-loader>

                <div v-else class="vivatura-translator-language-list">
                    <div
                        v-for="language in availableLanguages"
                        :key="language.id"
                        class="vivatura-translator-language-item"
                        :class="{ 'is--selected': isLanguageSelected(language.id) }"
                        @click="toggleLanguage(language.id)"
                    >
                        <sw-checkbox-field
                            :value="isLanguageSelected(language.id)"
                            :label="language.name"
                        ></sw-checkbox-field>
                        <span class="vivatura-translator-language-locale">{{ language.locale }}</span>
                    </div>
                </div>
            </div>
            {% endblock %}

            {% block vivatura_translator_progress %}
            <div v-if="isLoading && translationProgress > 0" class="vivatura-translator-progress">
                <sw-progress-bar :value="translationProgress"></sw-progress-bar>
                <p>{{ $tc('vivatura-translator.modal.translating') }}</p>
            </div>
            {% endblock %}

            {% block vivatura_translator_results %}
            <div v-if="translationResults" class="vivatura-translator-results">
                <h4>{{ $tc('vivatura-translator.modal.results') }}</h4>
                <div
                    v-for="(result, languageCode) in translationResults"
                    :key="languageCode"
                    class="vivatura-translator-result-item"
                    :class="{ 
                        'is--success': result.success, 
                        'is--error': !result.success 
                    }"
                >
                    <sw-icon 
                        :name="result.success ? 'regular-checkmark' : 'regular-times'" 
                        small
                    ></sw-icon>
                    <span class="vivatura-translator-result-language">{{ languageCode }}</span>
                    <span v-if="result.fields" class="vivatura-translator-result-fields">
                        {{ result.fields }} {{ $tc('vivatura-translator.modal.fieldsTranslated') }}
                    </span>
                    <span v-if="result.error" class="vivatura-translator-result-error">
                        {{ result.error }}
                    </span>
                </div>
            </div>
            {% endblock %}

        </div>
        {% endblock %}

        {% block vivatura_translator_modal_footer %}
        <template #modal-footer>
            <sw-button @click="closeModal">
                {{ $tc('vivatura-translator.modal.close') }}
            </sw-button>
            <sw-button
                v-if="!translationResults"
                variant="primary"
                :disabled="selectedLanguages.length === 0 || isLoading"
                @click="startTranslation"
            >
                <sw-loader v-if="isLoading" size="16px"></sw-loader>
                {{ $tc('vivatura-translator.modal.startTranslation') }}
            </sw-button>
        </template>
        {% endblock %}
    </sw-modal>
</div>
{% endblock %}
